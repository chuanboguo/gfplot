<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Spatial modeling of survey data — fit_survey_sets • gfplot</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Spatial modeling of survey data — fit_survey_sets" />

<meta property="og:description" content="Implements geostatistical models of trawl or longline survey data. Uses INLA
or glmmfields (currently disabled) for Bayesian inference." />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gfplot</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/commercial-cpue-index.html">Commercial CPUE</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/pbs-assess/gfplot">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Spatial modeling of survey data</h1>
    <small class="dont-index">Source: <a href='https://github.com/pbs-assess/gfplot/blob/master/R/surveys-spatial.R'><code>R/surveys-spatial.R</code></a></small>
    <div class="hidden name"><code>survey-spatial-modelling.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Implements geostatistical models of trawl or longline survey data. Uses INLA
or glmmfields (currently disabled) for Bayesian inference.</p>
    
    </div>

    <pre class="usage"><span class='fu'>fit_survey_sets</span>(<span class='no'>dat</span>, <span class='no'>years</span>, <span class='kw'>survey</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>density_column</span> <span class='kw'>=</span> <span class='st'>"density_kgpm2"</span>,
  <span class='kw'>chains</span> <span class='kw'>=</span> <span class='fl'>4</span>, <span class='kw'>iter</span> <span class='kw'>=</span> <span class='fl'>1000</span>, <span class='kw'>max_knots</span> <span class='kw'>=</span> <span class='fl'>20</span>, <span class='kw'>adapt_delta</span> <span class='kw'>=</span> <span class='fl'>0.95</span>,
  <span class='kw'>thin</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>mcmc_posterior_samples</span> <span class='kw'>=</span> <span class='fl'>150</span>, <span class='kw'>required_obs_percent</span> <span class='kw'>=</span> <span class='fl'>0.05</span>,
  <span class='kw'>utm_zone</span> <span class='kw'>=</span> <span class='fl'>9</span>, <span class='kw'>model</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"inla"</span>, <span class='st'>"glmmfields"</span>), <span class='kw'>include_depth</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>survey_boundary</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>premade_grid</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>inla_knots_pos</span> <span class='kw'>=</span> <span class='fl'>75</span>,
  <span class='kw'>inla_knots_bin</span> <span class='kw'>=</span> <span class='fl'>100</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dat</th>
      <td><p>Output from <code><a href='get.html'>get_survey_sets()</a></code>.</p></td>
    </tr>
    <tr>
      <th>years</th>
      <td><p>The year to include in the model. Should be a single year.</p></td>
    </tr>
    <tr>
      <th>survey</th>
      <td><p>The survey abbreviation. Should match the contents of the
column <code>survey_abbrev</code> in the data frame returned by <code><a href='get.html'>get_survey_sets()</a></code>.</p></td>
    </tr>
    <tr>
      <th>density_column</th>
      <td><p>The name of the column that includes the relative
biomass density to use. E.g. <code>"density_kgpm2"</code> for trawl surveys or
<code>"density_ppkm2"</code> for the long line surveys.</p></td>
    </tr>
    <tr>
      <th>chains</th>
      <td><p>The number of MCMC chains. Only applies to the glmmfields
model.</p></td>
    </tr>
    <tr>
      <th>iter</th>
      <td><p>The number of MCMC chains. Only applies to the glmmfields model.</p></td>
    </tr>
    <tr>
      <th>max_knots</th>
      <td><p>The maximum number of knots to use in the predictive process
approximation in the glmmfields model. If this number is larger than the
number of data points then the number of knots is set to the number of data
points minus 2. Only applies to the glmmfields model.</p></td>
    </tr>
    <tr>
      <th>adapt_delta</th>
      <td><p>Value to pass to <code><a href='http://www.rdocumentation.org/packages/rstan/topics/stanmodel-method-sampling'>rstan::sampling()</a></code>. Values closer to 1
make smaller steps in the Hamiltonian MCMC at the expense of speed. Only
applies to the glmmfields model.</p></td>
    </tr>
    <tr>
      <th>thin</th>
      <td><p>Value to pass to <code><a href='http://www.rdocumentation.org/packages/rstan/topics/stanmodel-method-sampling'>rstan::sampling()</a></code> to thin the MCMC samples.
Only applies to the glmmfields model.</p></td>
    </tr>
    <tr>
      <th>mcmc_posterior_samples</th>
      <td><p>Number of final MCMC samples to return. Applies
to both glmmfields and INLA.</p></td>
    </tr>
    <tr>
      <th>required_obs_percent</th>
      <td><p>A required fraction of positive sets before a
model is fit.</p></td>
    </tr>
    <tr>
      <th>utm_zone</th>
      <td><p>The UTM zone to perform the modeling in. Defaults to zone 9.</p></td>
    </tr>
    <tr>
      <th>model</th>
      <td><p>The backend software to fit the model. Options are <code>"inla"</code> or
<code>"glmmfields"</code> (currently disabled until on CRAN). INLA implements in
approximation of the posterior via the integrated nested Laplace
approximation, but the results are usually quite good and are likely drive
considerably faster than glmmfields, especially for larger data sets or for
many knots.</p></td>
    </tr>
    <tr>
      <th>include_depth</th>
      <td><p>Logical: should depth be included as a predictor? If
<code>FALSE</code> then the model will only have a spatial random field as the
predictor. Currently only applies to the INLA model.</p></td>
    </tr>
    <tr>
      <th>survey_boundary</th>
      <td><p>If not <code>NULL</code>, a data frame with the survey boundary
defined in columns <code>X</code> and <code>Y</code> in longitude and latitude coordinates. If
<code>NULL</code>, the functions will search for a matching element in the included
the data object <code><a href='survey_boundaries.html'>gfplot::survey_boundaries</a></code> based on the <code>survey</code> argument
(after removing "SYN" from the name).</p></td>
    </tr>
    <tr>
      <th>premade_grid</th>
      <td><p>If not <code>NULL</code>, a list object with an element <code>grid</code> that
contains a data frame with columns <code>X</code>, <code>Y</code>, and <code>depth</code>, and another
element <code>cell_area</code> the content a single numeric value describing the grid
size in kilometers. The package includes a survey grid for the HBLL surveys
in <code><a href='hbll_grid.html'>gfplot::hbll_grid</a></code>.</p></td>
    </tr>
    <tr>
      <th>inla_knots_pos</th>
      <td><p>The number of knots for the positive component model if
fit with INLA.</p></td>
    </tr>
    <tr>
      <th>inla_knots_bin</th>
      <td><p>The number of knots for the binary component model if
fit with INLA.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Any other arguments to pass on to <code><a href='fit_inla.html'>fit_inla()</a></code>.</p></td>
    </tr>
    </table>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>set.seed</span>(<span class='fl'>123</span>)
<span class='co'># pop_surv &lt;- get_survey_sets("pacific ocean perch")</span>
<span class='co'># or use built-in data:</span>
<span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'>fit_survey_sets</span>(<span class='no'>pop_surv</span>,
  <span class='kw'>years</span> <span class='kw'>=</span> <span class='fl'>2015</span>,
  <span class='kw'>survey</span> <span class='kw'>=</span> <span class='st'>"SYN QCS"</span>)</div><div class='output co'>#&gt; <span class='message'>Interpolating depth to fill in missing data if needed...</span></div><div class='output co'>#&gt; <span class='message'>Preloading interpolated depth for prediction grid...</span></div><div class='output co'>#&gt; <span class='message'>Predicting density onto grid...</span></div><div class='input'><span class='fu'>names</span>(<span class='no'>fit</span>)</div><div class='output co'>#&gt; [1] "predictions" "data"        "models"      "survey"      "years"      </div><div class='input'><span class='fu'><a href='plot_survey_sets.html'>plot_survey_sets</a></span>(<span class='no'>fit</span>$<span class='no'>predictions</span>, <span class='no'>fit</span>$<span class='no'>data</span>, <span class='kw'>fill_column</span> <span class='kw'>=</span> <span class='st'>"combined"</span>)</div><div class='img'><img src='survey-spatial-modelling-1.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
            
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Sean Anderson, Elise Keppel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

